var te=t=>JSON.parse(JSON.stringify(t));var oe=()=>String(Math.random())+"-"+Date.now().toFixed();var P=(t,n)=>new Promise((s,i)=>{if(n&&globalThis[n])return s(globalThis[n]);if(typeof globalThis.importScripts=="function")return globalThis.importScripts(t),n&&globalThis[n]?s(globalThis[n]):s(globalThis);let d=document.createElement("script");d.src=t,d.async=!0;let a=()=>{d.removeEventListener("load",p),d.removeEventListener("error",j)},p=()=>{if(a(),!n)return s("loaded: "+t);let g=setInterval(()=>{if(window[n])return clearInterval(g),s(window[n])},5)},j=()=>{a(),i("failed to load: "+t)};d.addEventListener("load",p),d.addEventListener("error",j),document.head.appendChild(d)});var F=t=>t.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1");var re=["esm.sh","skypack","jspm"],se=["unpkg","jsdelivr","fastly.jsdelivr"],ie=["fastly.jsdelivr.gh","jsdelivr.gh","statically"],k={getModuleUrl:(t,{isModule:n=!0,defaultCDN:s="esm.sh"}={})=>{t=t.replace(/#nobundle/g,"");let i=ne(t,n,s);return i||(n?"https://esm.sh/"+t:"https://cdn.jsdelivr.net/npm/"+t)},getUrl:(t,n)=>t.startsWith("http")||t.startsWith("data:")?t:ne(t,!1,n||Ye())||t,cdnLists:{npm:se,module:re,gh:ie},checkCDNs:async(t,n)=>{let s=[n,...k.cdnLists.npm].filter(Boolean);for(let i of s)try{if((await fetch(k.getUrl(t,i),{method:"HEAD"})).ok)return i}catch{}return k.cdnLists.npm[0]}},Ye=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||k.cdnLists.npm[0]}catch{return k.cdnLists.npm[0]}},ne=(t,n,s)=>{let i=n&&t.startsWith("unpkg:")?"?module":"";t.startsWith("gh:")?t=t.replace("gh",ie[0]):t.includes(":")||(t=(s||(n?re[0]:se[0]))+":"+t);for(let d of et){let[a,p]=d;if(a.test(t))return t.replace(a,p)+i}return null},et=[[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(npm:)(.+)/i,"https://esm.sh/$2"],[/^(node:)(.+)/i,"https://esm.sh/$2"],[/^(jsr:)(.+)/i,"https://esm.sh/jsr/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(jsdelivr.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly.jsdelivr.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm.run:)(.+)/i,"https://esm.run/$2"],[/^(esm.sh:)(.+)/i,"https://esm.sh/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:v,getModuleUrl:ht}=k;var ae=v("@live-codes/monaco-codeium-provider@0.2.2/dist/index.js");var ce=v("emmet-monaco-es@5.0.0/dist/emmet-monaco.js");var tt="0.6.64",ft=v(`malinajs@${tt}/malina.js`);var le=v("monaco-emacs@0.3.0/dist/monaco-emacs.js"),o=v("monaco-themes@0.4.4/themes/"),me=v("monaco-vim@0.4.0/dist/monaco-vim.js");var ot=/(import\s+?(?:(?:(?:[\w*\s{},\$]*)\s+from\s+?)|))((?:".*?")|(?:'.*?'))([\s]*?(?:;|$|))/g,nt=/(import\s*?\(\s*?((?:".*?")|(?:'.*?'))\s*?\))/g,pe=(t,n=!1)=>[...F(t).matchAll(new RegExp(ot)),...F(t).matchAll(new RegExp(nt))].map(s=>s[2].replace(/"/g,"").replace(/'/g,"")).map(s=>!n||!rt(s)||!s.includes(":")?s:s.split(":")[1]);var rt=t=>!t.startsWith("https://")&&!t.startsWith("http://")&&!t.startsWith(".")&&!t.startsWith("/")&&!t.startsWith("data:")&&!t.startsWith("blob:");var ue=()=>document.querySelector("#editor-mode");var de=t=>`https://ofcncog2cu-dsn.algolia.net/1/indexes/npm-search/${encodeURIComponent(t)}?x-algolia-agent=Browser`,ge={"X-Algolia-Application-Id":"OFCNCOG2CU","X-Algolia-API-Key":"f54e21fa3a2a0160595bb058179bfb1e"},he=["name","description","homepage","repository.url","version"],_="https://data.jsdelivr.com/v1",V={"User-Agent":"https://livecodes.io"},U=t=>{let n=t.startsWith("@"),s=n?t.slice(1):t,[i,d]=s.split("@");return[(n?"@":"")+i,d]},st=async(t,n=10)=>{let s={page:0,hitsPerPage:n,attributesToHighlight:[],attributesToRetrieve:he,analyticsTags:["jsdelivr"]},[i,d]=U(t),a;if(d){let g=await D(t);typeof g=="string"&&(a=U(g)[1])}let p=await fetch(de("query"),{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8",...ge},body:JSON.stringify({query:i,...s})}).then(g=>{if(!g.ok)throw new Error("failed to fetch");return g}).then(g=>g.json()).catch(g=>({error:!0,message:g.mesage||String(g)}));if("error"in p)return p;let j=p.hits.map(g=>(g.name===i&&a&&(g.version=a),g.repository?.url&&(g.repo=g.repository?.url),g));return j.sort((g,R)=>g.name===i?-1:R.name===i?1:0),j},D=async t=>{let n=`${_}/package/resolve/npm/${t}`,s=await fetch(n,{headers:V}).then(a=>{if(!a.ok)throw new Error("failed to fetch");return a}).then(a=>a.json()).catch(a=>({error:!0,message:a.mesage||String(a)}));if("error"in s)return s;let i=U(t)[0],d=s.version;return d?`${i}@${d}`:i},it=async t=>{let[n,s]=U(t),i;if(s){let p=await D(t);typeof p=="string"&&(i=U(p)[1])}let d=de(n)+"&attributesToRetrieve="+he.join(","),a=await fetch(d,{method:"GET",headers:ge}).then(p=>{if(!p.ok)throw new Error("failed to fetch");return p}).then(p=>p.json()).catch(p=>({error:!0,message:p.mesage||String(p)}));return"error"in a||(i&&(a.version=i),a.repository?.url&&(a.repo=a.repository?.url)),a},at=async t=>{let n=await D(t),s=`${_}/package/npm/${n}/flat`,i=await fetch(s,{headers:V}).then(a=>{if(!a.ok)throw new Error("failed to fetch");return a}).then(a=>a.json()).catch(a=>({error:!0,message:a.mesage||String(a)}));if("error"in i)return i;let d=`https://cdn.jsdelivr.net/npm/${n}`;return{...i.default?{default:d+i.default}:{},files:i.files.map(a=>d+a.name)}},ct=async t=>{let n=await D(t),s=`${_}/package/npm/${n}/entrypoints`,i=await fetch(s,{headers:V}).then(a=>{if(!a.ok)throw new Error("failed to fetch");return a}).then(a=>a.json()).catch(a=>({error:!0,message:a.mesage||String(a)}));if("error"in i)return i;let d=`https://cdn.jsdelivr.net/npm/${n}`;return{...i.js?.file?{js:d+i.js?.file}:{},...i.css?.file?{css:d+i.css?.file}:{}}},fe={search:st,getPkgInfo:it,getPkgFiles:at,getPkgDefaultFiles:ct};var lt=t=>{let n=t.trim(),s,i;return t.includes(":")&&([s,n]=n.split(":"),s!=="monaco"&&s!=="codemirror"&&s!=="codejar"&&(s=void 0)),t.includes("@")&&([n,i]=n.split("@"),i!=="light"&&i!=="dark"&&(i=void 0)),{editor:s,editorTheme:n,theme:i}},xe=({editor:t,editorTheme:n,theme:s,editorThemes:i})=>{if(!n)return null;let a=(typeof n=="string"?n.split(",").map(p=>p.trim()):n).map(lt);for(let p of a)if((p.editor===t||p.editor===void 0)&&(p.theme===s||p.theme===void 0)&&i.includes(p.editorTheme))return p.editorTheme;return null};var z=[{name:"active4d",title:"Active4D",url:o+"Active4D.json"},{name:"all-hallows-eve",title:"All Hallows Eve",url:o+"All Hallows Eve.json"},{name:"amy",title:"Amy",url:o+"Amy.json"},{name:"birds-of-paradise",title:"Birds of Paradise",url:o+"Birds of Paradise.json"},{name:"blackboard",title:"Blackboard",url:o+"Blackboard.json"},{name:"brilliance-black",title:"Brilliance Black",url:o+"Brilliance Black.json"},{name:"brilliance-dull",title:"Brilliance Dull",url:o+"Brilliance Dull.json"},{name:"chrome-devtools",title:"Chrome DevTools",url:o+"Chrome DevTools.json"},{name:"clouds-midnight",title:"Clouds Midnight",url:o+"Clouds Midnight.json"},{name:"clouds",title:"Clouds",url:o+"Clouds.json"},{name:"cobalt",title:"Cobalt",url:o+"Cobalt.json"},{name:"cobalt2",title:"Cobalt2",url:o+"Cobalt2.json"},{name:"dawn",title:"Dawn",url:o+"Dawn.json"},{name:"dracula",title:"Dracula",url:o+"Dracula.json"},{name:"dreamweaver",title:"Dreamweaver",url:o+"Dreamweaver.json"},{name:"eiffel",title:"Eiffel",url:o+"Eiffel.json"},{name:"espresso-libre",title:"Espresso Libre",url:o+"Espresso Libre.json"},{name:"github",title:"GitHub",url:o+"GitHub.json"},{name:"github-dark",title:"GitHub Dark",url:o+"GitHub Dark.json"},{name:"github-light",title:"GitHub Light",url:o+"GitHub Light.json"},{name:"hc-black",title:"High Contrast (Black)"},{name:"hc-light",title:"High Contrast (Light)"},{name:"idle",title:"Idle",url:o+"IDLE.json"},{name:"idlefingers",title:"Idle Fingers",url:o+"idleFingers.json"},{name:"iplastic",title:"iPlastic",url:o+"iPlastic.json"},{name:"katzenmilch",title:"Katzenmilch",url:o+"Katzenmilch.json"},{name:"krtheme",title:"krTheme",url:o+"krTheme.json"},{name:"kuroir",title:"Kuroir Theme",url:o+"Kuroir Theme.json"},{name:"lazy",title:"Lazy",url:o+"LAZY.json"},{name:"magicwb-amiga",title:"MagicWB (Amiga)",url:o+"MagicWB (Amiga).json"},{name:"merbivore-soft",title:"Merbivore Soft",url:o+"Merbivore Soft.json"},{name:"merbivore",title:"Merbivore",url:o+"Merbivore.json"},{name:"monochrome",title:"Monochrome"},{name:"monochrome-dark",title:"Monochrome Dark"},{name:"monoindustrial",title:"monoindustrial",url:o+"monoindustrial.json"},{name:"monokai",title:"Monokai",url:o+"Monokai.json"},{name:"monokai-bright",title:"Monokai Bright",url:o+"Monokai Bright.json"},{name:"night-owl",title:"Night Owl",url:o+"Night Owl.json"},{name:"nord",title:"Nord",url:o+"Nord.json"},{name:"oceanic-next",title:"Oceanic Next",url:o+"Oceanic Next.json"},{name:"pastels-on-dark",title:"Pastels on Dark",url:o+"Pastels on Dark.json"},{name:"slush-and-poppies",title:"Slush and Poppies",url:o+"Slush and Poppies.json"},{name:"solarized-dark",title:"Solarized Dark",url:o+"Solarized-dark.json"},{name:"solarized-light",title:"Solarized Light",url:o+"Solarized-light.json"},{name:"spacecadet",title:"SpaceCadet",url:o+"SpaceCadet.json"},{name:"sunburst",title:"Sunburst",url:o+"Sunburst.json"},{name:"textmate-mac-classic",title:"Textmate (Mac Classic)",url:o+"Textmate (Mac Classic).json"},{name:"tomorrow",title:"Tomorrow",url:o+"Tomorrow.json"},{name:"tomorrow-night",title:"Tomorrow Night",url:o+"Tomorrow-Night.json"},{name:"tomorrow-night-blue",title:"Tomorrow Night Blue",url:o+"Tomorrow-Night-Blue.json"},{name:"tomorrow-night-bright",title:"Tomorrow Night Bright",url:o+"Tomorrow-Night-Bright.json"},{name:"tomorrow-night-eighties",title:"Tomorrow Night Eighties",url:o+"Tomorrow-Night-Eighties.json"},{name:"twilight",title:"Twilight",url:o+"Twilight.json"},{name:"upstream-sunburst",title:"Upstream Sunburst",url:o+"Upstream Sunburst.json"},{name:"vibrant-ink",title:"Vibrant Ink",url:o+"Vibrant Ink.json"},{name:"vs",title:"VS"},{name:"vs-dark",title:"VS Dark"},{name:"xcode-default",title:"Xcode Default",url:o+"Xcode_default.json"},{name:"zenburnesque",title:"Zenburnesque",url:o+"Zenburnesque.json"}],ye=[{name:"custom-vs-light",theme:{base:"vs",inherit:!0,rules:[{token:"comment",fontStyle:"italic"}],colors:{}}},{name:"custom-vs-dark",theme:{base:"vs-dark",inherit:!0,rules:[{token:"comment",fontStyle:"italic"}],colors:{}}},{name:"monochrome",theme:{base:"vs",inherit:!1,rules:[],colors:{"editor.foreground":"#24292e","editorBracketHighlight.foreground1":"#24292e","editorBracketHighlight.foreground2":"#24292e","editorBracketHighlight.foreground3":"#24292e","editorBracketHighlight.foreground4":"#24292e","editorBracketHighlight.unexpectedBracket.foreground":"#24292e"}}},{name:"monochrome-dark",theme:{base:"vs-dark",inherit:!1,rules:[],colors:{"editor.foreground":"#e2e2e3","editor.background":"#24292e","editorBracketHighlight.foreground1":"#e2e2e3","editorBracketHighlight.foreground2":"#e2e2e3","editorBracketHighlight.foreground3":"#e2e2e3","editorBracketHighlight.foreground4":"#e2e2e3","editorBracketHighlight.unexpectedBracket.foreground":"#e2e2e3"}}}];var be=!1,M={},c,Ee=new Set,I,$=[],Vt=async t=>{let{container:n,baseUrl:s,readonly:i,theme:d,editorTheme:a,isEmbed:p,getLanguageExtension:j,mapLanguage:g,getFormatterConfig:R,getFontFamily:Te}=t;if(!n)throw new Error("editor container not found");let x,K=e=>({fontFamily:Te(e.fontFamily),fontSize:e.fontSize||(p?12:14),insertSpaces:!e.useTabs,detectIndentation:!1,tabSize:e.tabSize,lineNumbers:e.lineNumbers?"on":"off",wordWrap:e.wordWrap?"on":"off",autoClosingBrackets:e.closeBrackets?"always":"never",autoClosingQuotes:e.closeBrackets?"always":"never",autoClosingDelete:e.closeBrackets?"always":"never"}),Le=K(t),q=e=>e==="livescript"?"coffeescript":["rescript","reason","ocaml"].includes(e)?"csharp":g(e),T=s+"vendor/monaco-editor/v0.40.0";try{window.monaco=window.monaco||(await import(`${T}/monaco-editor.js`)).monaco,c=window.monaco}catch{throw new Error("Failed to load monaco editor")}ye.forEach(e=>c.editor.defineTheme(e.name,e.theme));let J=async(e,r)=>{let l=xe({editor:"monaco",editorTheme:r,theme:e,editorThemes:z.map(m=>m.name)}),h=l==="vs"?"custom-vs-light":l==="vs-dark"?"custom-vs-dark":l||"custom-vs-"+e;if(Ee.has(h))return h;let f=z.find(m=>m.name===h);return f?.url&&await fetch(f.url).then(m=>m.json()).then(m=>{c.editor.defineTheme(h,m),Ee.add(h)}),h},Me=(e,r)=>{J(e,r).then(l=>{c.editor.setTheme(l)})},B={theme:await J(d,a),fontLigatures:!0,formatOnType:!1,lineNumbersMinChars:3,minimap:{enabled:!1},scrollbar:{useShadows:!1},mouseWheelZoom:!0,automaticLayout:!0,readOnly:i,fixedOverflowWidgets:!0},Se={...B,scrollBeyondLastLine:!1,contextmenu:!1},we={...B,scrollBeyondLastLine:!1},G={...B,glyphMargin:!0,folding:!1,lineDecorationsWidth:0,lineNumbersMinChars:0,scrollbar:{vertical:"auto"},scrollBeyondLastLine:!1,contextmenu:!1},ke={...G},H=t.editorId,Z=H==="console"?G:H==="compiled"?we:H==="embed"?ke:t.mode==="codeblock"?Se:B,S=te({...Le,...Z});if(!document.head.querySelector("#__livecodes__monaco-styles")){let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href",`${T}/monaco-editor.css`),e.id="__livecodes__monaco-styles",document.head.appendChild(e)}window.MonacoEnvironment={getWorkerUrl(e,r){return r==="json"?`${T}/json.worker.js`:r==="css"?`${T}/css.worker.js`:r==="scss"?`${T}/css.worker.js`:r==="sass"?`${T}/css.worker.js`:r==="less"?`${T}/css.worker.js`:r==="html"?`${T}/html.worker.js`:r==="typescript"||r==="javascript"?`${T}/ts.worker.js`:`${T}/editor.worker.js`}};let je=()=>{let e={jsx:c.languages.typescript.JsxEmit.Preserve,allowNonTsExtensions:!0,allowJs:!1,target:c.languages.typescript.ScriptTarget.Latest,experimentalDecorators:!0,allowSyntheticDefaultImports:!0,lib:["esnext","dom"],module:c.languages.typescript.ModuleKind.ESNext};c.languages.typescript.typescriptDefaults.setCompilerOptions(e),(y==="tsx"||y==="jsx"||y==="sucrase"||y==="babel"||y==="flow")&&c.languages.typescript.typescriptDefaults.setCompilerOptions({...e,jsx:c.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",reactNamespace:"React"}),y==="stencil"&&c.languages.typescript.typescriptDefaults.setCompilerOptions({...e,jsx:c.languages.typescript.JsxEmit.Preserve,jsxFactory:void 0,reactNamespace:"h"}),y==="flow"?c.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0}):["typescript"].includes(g(y))&&c.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1})},W=[],He=()=>{W.forEach(e=>u.getModel()?.onDidChangeContent(e))},Q="",X=(e,r,l)=>{let h=oe(),f=j(l),m=q(l)==="typescript"&&!f?.endsWith("ts")&&!f?.endsWith("tsx")?f+".tsx":f;Q=`file:///${H}.${h}.${m}`;let E=e.getModel(),b=c.editor.createModel(r||"",q(l),c.Uri.parse(Q));e.setModel(b),setTimeout(()=>E?.dispose(),1e3),He(),je()},y=t.language,u=c.editor.create(n,{...S,language:q(y)});X(u,t.value,y),["markup","style","script","tests"].includes(H)&&$.push(u),S.theme==="vs-light"&&(n.style.backgroundColor="#fff"),(S.theme?.startsWith("http")||S.theme?.startsWith("./"))&&fetch(S.theme).then(e=>e.json()).then(e=>{c.editor.defineTheme("theme",e),c.editor.setTheme("theme"),n.style.backgroundColor=e.colors["editor.background"]});let ve={astro:s+"monaco-lang-astro.31ace80fb590384d92861650cd635109.js",clio:s+"monaco-lang-clio.bdef68dfea0312fab9a27b5d87146182.js",imba:s+"monaco-lang-imba.b0acc149ca1c00547c24cad4172e8f22.js",wat:s+"monaco-lang-wat.90de1d50eb45ed8f299322a2d8c6f760.js"},qe=async e=>{let r=ve[e];if(r&&!c.languages.getLanguages().find(l=>l.id===e)){let l=(await import(r)).default;c.languages.register({id:e}),l.config&&c.languages.setLanguageConfiguration(e,l.config),l.tokens&&c.languages.setMonarchTokensProvider(e,l.tokens)}},Ce=()=>H,Ue=()=>u.getValue(),Ie=(e="")=>{u.getModel()?.setValue(e)},A=[],N=e=>!e.filename.startsWith("file:///node_modules/"),Y=(e=!0)=>{A.filter(r=>e?!0:N(r)).forEach(r=>{r.libJs.dispose(),r.libTs.dispose()}),A.length=0},Be=()=>y,Ae=(e,r)=>{y=e,Y(!1),X(u,r??u.getValue(),y),qe(e)},Pe=(e,r=!1)=>{let l=A.find(h=>h.filename===e.filename);if(l){if(N(e)&&(l.libJs.dispose(),l.libJs=c.languages.typescript.javascriptDefaults.addExtraLib(e.content,e.filename)),!r)return;l.libJs?.dispose(),l.libTs?.dispose()}A.push({filename:e.filename,libJs:c.languages.typescript.javascriptDefaults.addExtraLib(e.content,e.filename),libTs:N(e)?{dispose:()=>{}}:c.languages.typescript.typescriptDefaults.addExtraLib(e.content,e.filename)})},De=()=>u.focus(),$e=()=>u.layout(),Re=e=>{W.push(e),u.getModel()?.onDidChangeContent(e)},We={CtrlEnter:c.KeyMod.CtrlCmd|c.KeyCode.Enter,ShiftEnter:c.KeyMod.Shift|c.KeyCode.Enter,Enter:c.KeyCode.Enter,UpArrow:c.KeyCode.UpArrow,DownArrow:c.KeyCode.DownArrow,ShiftAltF:c.KeyMod.Shift|c.KeyMod.Alt|c.KeyCode.KeyF},Ne=(e,r,l)=>{u.addAction({id:e,label:e,keybindings:[r],precondition:"!suggestWidgetVisible && !markersNavigationVisible && !findWidgetVisible",run:l})},ee=async e=>{let r=ue(),l=document.querySelector(`#editor-status [data-status="${t.editorId}"]`),h=m=>{r&&(r.textContent=m)},f=m=>{l&&(l.textContent=m)};if(!e){x?.dispose(),x=void 0,f(""),h("");return}if(e==="vim"){if(x?.mode==="vim")return;x?.mode==="emacs"&&(x.dispose(),f(""));let m=await P(me,"MonacoVim"),E=l?.innerHTML!==""?void 0:l;x=m.initVimMode(u,E),x.mode="vim",h("Vim")}if(e==="emacs"){if(x?.mode==="emacs")return;x?.mode==="vim"&&(x.dispose(),f(""));let m=await P(le,"MonacoEmacs");x=new m.EmacsExtension(u),f(""),x.onDidMarkChange(function(E){f(E?"Mark Set!":"Mark Unset")}),x.onDidChangeKey(function(E){f(E)}),x.start(),x.mode="emacs",h("Emacs")}};ee(t.editorMode);let Oe=e=>{let r=u.getModel();!e||!r||c.languages.registerDocumentFormattingEditProvider(q(y),{provideDocumentFormattingEdits:async()=>{let l=u.getValue(),h=await e(l,0,R());return[{range:r.getFullModelRange(),text:h.formatted}]}})},Fe=async()=>u.getAction("editor.action.formatDocument")?.run(),_e=e=>{!e&&!window.emmetMonaco||P(ce,"emmetMonaco").then(r=>{e?(!M.html||M.disabled)&&(M.html=r.emmetHTML(c,["html","php","astro","markdown","mdx"]),M.css=r.emmetCSS(c,["css","scss","less"]),M.jsx=r.emmetJSX(c,["javascript","typescript","jsx","tsx"]),M.disabled=!1):(M.html?.(),M.css?.(),M.jsx?.(),M.disabled=!0)})},Ve=e=>{S={...K(e),...Z},_e(e.emmet),ee(e.editorMode),u.updateOptions(S),Ze(e.enableAI)},ze=()=>{u.getModel()?.undo?.()},Ke=()=>{u.getModel()?.redo?.()},Je=()=>{let e=u.getPosition();return{lineNumber:e?.lineNumber??1,column:e?.column??1}},Ge=e=>{let r={lineNumber:e.lineNumber,column:e.column??1};u.setPosition(r),setTimeout(()=>u.revealPositionInCenter(r,0),50)},Ze=e=>{if(!e){I?.dispose(),I=void 0;return}I||(I={dispose:()=>"loading..."},import(ae).then(r=>{I=r.registerCodeiumProvider(c,{getEditors:()=>$})}))},Qe=()=>{$=$.filter(e=>e!==u),x?.dispose(),W.length=0,Y(!0),u.getModel()?.dispose(),u.dispose(),n.innerHTML=""};window.addEventListener("unhandledrejection",function(e){e.reason&&e.reason.name==="Canceled"&&e.preventDefault()});let Xe=e=>{let r=["html","markdown","javascript","typescript"],l=u.getModel();if(!l||!r.includes(q(y))||S.autoClosingBrackets==="never")return;let h=f=>["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr","circle","ellipse","line","path","polygon","polyline","rect","stop","use"].includes(f);if(e.browserEvent.key===">"){let f=u.getSelections()||[],m=[],E=[];for(let b of f){E.push(new c.Selection(b.selectionStartLineNumber,b.selectionStartColumn+1,b.endLineNumber,b.endColumn+1));let L=l.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:b.endLineNumber,endColumn:b.endColumn}).match(/<([\w-]+)(?![^>]*\/>)[^>]*$/);if(!L)continue;let[O,C]=L;h(C)||O.trim().endsWith("/")||m.push({range:{startLineNumber:b.endLineNumber,startColumn:b.endColumn+1,endLineNumber:b.endLineNumber,endColumn:b.endColumn+1},text:`</${C}>`})}setTimeout(()=>{u.executeEdits(l.getValue(),m,E)},0)}};return u.onKeyDown(Xe),be||(()=>{let e=new Map,r={provideHover(l,h){let f=l.getLineContent(h.lineNumber),m=pe(f,!0)[0];if(!m||m.startsWith("https://")||m.startsWith("http://")||m.startsWith(".")||m.startsWith("data:")||m.startsWith("blob:"))return;let E=m.split("/"),b=E[0].startsWith("@")?2:1;return m=E.slice(0,b).join("/"),(async()=>{let w;if(e.has(m))w=e.get(m);else{if(w=await fe.getPkgInfo(m),"error"in w)return;e.set(m,w)}if(!w||"error"in w)return;let{name:L,description:O="",repo:C=""}=w;return{contents:[{value:`## [${L}](https://www.npmjs.com/package/${L})
${O}


${C?`[GitHub](${C}) |`:""} [Skypack](https://skypack.dev/view/${L}) | [jsDelivr](https://www.jsdelivr.com/package/npm/${L}) | [Unpkg](https://unpkg.com/browse/${L}/) | [Snyk](https://snyk.io/advisor/npm-package/${L}) | [Bundlephobia](https://bundlephobia.com/package/${L})

Docs: [Importing modules](${new URL("/livecodes/docs/",location.href).href}features/module-resolution)`}]}})()}};c.languages.registerHoverProvider("javascript",r),c.languages.registerHoverProvider("typescript",r),c.languages.registerHoverProvider("html",r)})(),be=!0,{getValue:Ue,setValue:Ie,getLanguage:Be,setLanguage:Ae,getEditorId:Ce,focus:De,getPosition:Je,setPosition:Ge,layout:$e,addTypes:Pe,changeSettings:Ve,onContentChanged:Re,keyCodes:We,addKeyBinding:Ne,registerFormatter:Oe,format:Fe,isReadonly:i,setTheme:Me,undo:ze,redo:Ke,destroy:Qe,monaco:u}};export{Vt as createEditor};
